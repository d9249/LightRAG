
# 문서 처리

<cite>
**이 문서에서 참조된 파일**
- [lightrag.py](file://lightrag/lightrag.py)
- [operate.py](file://lightrag/operate.py)
- [base.py](file://lightrag/base.py)
- [types.py](file://lightrag/types.py)
- [utils.py](file://lightrag/utils.py)
- [document_routes.py](file://lightrag/api/routers/document_routes.py)
- [json_doc_status_impl.py](file://lightrag/kg/json_doc_status_impl.py)
</cite>

## 목차
1. [청크화 과정](#청크화-과정)
2. [청크 설정의 영향](#청크-설정의-영향)
3. [데이터 구조 및 처리 흐름](#데이터-구조-및-처리-흐름)
4. [다양한 파일 형식 처리](#다양한-파일-형식-처리)
5. [문서 삽입 및 상태 관리 API](#문서-삽입-및-상태-관리-api)

## 청크화 과정

LightRAG은 문서를 처리할 때 `chunking_by_token_size` 함수를 사용하여 문서를 토큰 단위로 청크화합니다. 이 함수는 토큰화된 텍스트를 기반으로 문서를 분할하며, 설정된 최대 토큰 크기와 오버랩 토큰 크기를 고려하여 청크를 생성합니다. 청크화 과정은 다음과 같습니다:

1. 문서의 전체 텍스트를 토큰화합니다.
2. 설정된 `chunk_token_size`와 `chunk_overlap_token_size`를 기반으로 청크를 생성합니다.
3. 각 청크는 토큰 수, 내용, 전체 문서 ID, 청크 순서 인덱스 등의 정보를 포함하는 `TextChunkSchema` 데이터 구조를 따릅니다.
4. 생성된 청크들은 문서 처리 과정에서 사용되며, 이후 벡터 저장소에 저장됩니다.

**청크화 과정의 주요 단계**
- 문서 텍스트를 토큰화
- 설정된 토큰 크기와 오버랩을 기반으로 청크 생성
- 각 청크에 메타데이터 추가
- 청크 리스트 반환

**청크화 함수의 파라미터**
- `tokenizer`: 토큰화에 사용할 토크나이저 인스턴스
- `content`: 청크화할 텍스트
- `split_by_character`: 텍스트를 분할할 기준 문자 (옵션)
- `split_by_character_only`: 지정된 문자로만 분할할지 여부
- `chunk_token_size`: 청크당 최대 토큰 수
- `chunk_overlap_token_size`: 연속된 청크 간 오버랩 토큰 수

**청크화 과정의 결과**
- 문서가 설정된 토큰 크기로 분할된 청크 리스트
- 각 청크는 `TextChunkSchema` 구조를 따름
- 청크들은 이후 벡터 저장소에 저장되어 검색에 사용됨

**청크화 과정의 예외 처리**
- 빈 문서 또는 텍스트가 없는 경우 경고 메시지 출력
- 텍스트 인코딩 오류 발생 시 예외 처리
- 청크 생성 실패 시 적절한 오류 메시지 기록

**청크화 과정의 성능 고려사항**
- 대용량 문서 처리 시 메모리 사용량 최적화
- 병렬 처리를 통한 처리 속도 향상
- 토큰화 및 청크화 과정의 캐싱을 통한 반복 작업 최적화

**청크화 과정의 확장성**
- 사용자 정의 청크화 함수 지원
- 다양한 토크나이저와의 호환성
- 동적 청크 크기 조정 기능

**청크화 과정의 모니터링**
- 청크화 과정의 로그 기록
- 처리 속도 및 리소스 사용량 모니터링
- 오류 발생 시 자동 복구 메커니즘

**청크화 과정의 테스트 및 검증**
- 다양한 문서 유형에 대한 테스트
- 경계 조건 테스트 (매우 짧은 문서, 매우 긴 문서 등)
- 성능 벤치마크 테스트

**청크화 과정의 문서화**
- 청크화 알고리즘의 상세 설명
- 파라미터 설정 가이드
- 일반적인 문제 해결 가이드

**청크화 과정의 보안 고려사항**
- 사용자 입력 검증
- 임시 파일 처리 보안
- 권한 관리

**청크화 과정의 유지보수**
- 코드 리팩토링 계획
- 버전 관리 전략
- 문서 업데이트 주기

**청크화 과정의 사용자 경험**
- 직관적인 설정 인터페이스
- 실시간 처리 상태 표시
- 오류 메시지의 명확성

**청크화 과정의 통합**
- 다른 시스템과의 호환성
- API 통합 가이드
- 외부 도구와의 연동

**청크화 과정의 최적화**
- 알고리즘 성능 개선
- 메모리 사용량 최적화
- 처리 속도 향상

**청크화 과정의 확장 기능**
- 고급 청크화 전략
- 커스텀 분할 규칙
- 동적 청크 크기 조